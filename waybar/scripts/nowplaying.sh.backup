#!/bin/bash

# Obtener título y artista
title=$(playerctl metadata title 2>/dev/null)
artist=$(playerctl metadata artist 2>/dev/null)

# Obtener duración y posición en segundos
duration=$(playerctl metadata mpris:length 2>/dev/null)
position=$(playerctl position 2>/dev/null)

# Convertir nanosegundos a segundos (duración puede estar en ns)
if [[ "$duration" -gt 100000 ]]; then
  duration=$((duration / 1000000))  # convertir a milisegundos
  duration=$((duration / 1000))     # convertir a segundos
fi

# Redondear posición
position=${position%.*}

# Función para formatear segundos a mm:ss
format_time() {
  local T=$1
  printf "%02d:%02d" $((T / 60)) $((T % 60))
}

pos_str=$(format_time "$position")

# Mostrar salida
if [ -n "$title" ]; then
  echo "$artist - $title | $pos_str"
else
  echo "No media"
fi
